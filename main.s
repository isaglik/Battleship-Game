;****************************************
; Nokia5110-main.s
; Used to test Nokia5110-Class.s
; include startup.s

;***************************************************************
; Program section					      
;***************************************************************
;LABEL		DIRECTIVE	VALUE			COMMENT
			AREA    |.text|, READONLY, CODE
			THUMB
;Storage adresses
XPOSB	   	EQU	    	0x20000400
YPOSB	   	EQU	    	0x20000420
YPOSBITB   	EQU	    	0x20000440	
XPOSC	   	EQU	    	0x20000460
YPOSC	   	EQU	    	0x20000480
YPOSBITC   	EQU	    	0x20000500

imgFrame
			DCB	    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
			DCB		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff

imglogo		DCB		 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xc0, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 
			DCB 	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xf0, 0xf8, 0xfc, 0x7c, 0xfe, 0xff, 0xfb, 0x7f, 0x7f, 0x3f, 0x3b, 0x9f, 0xfb, 0x7f, 0x3f, 0x1f, 0x0f, 0x07, 0x87, 0xc3, 0x61, 0xe1, 0xf1, 0xf1, 0xf0, 0x70, 0xf0, 0xf0, 0xf0, 0x90, 0x30, 0x31, 0x61, 0x43, 0xc3, 0x86, 0x06, 0x0c, 0x18, 0x38, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 
			DCB	  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xc0, 0xc0, 0xe0, 0xe0, 0xc0, 0xc0, 0xe0, 0xc0, 0xe0, 0xe0, 0xf8, 0xff, 0xff, 0xfb, 0xff, 0xff, 0xff, 0xcf, 0xe3, 0xe1, 0xe0, 0xc0, 0xe0, 0xf8, 0xff, 0x07, 0x01, 0x00, 0xf0, 0xfc, 0xff, 0xc3, 0xe1, 0xc0, 0xe0, 0xe1, 0xc1, 0xc7, 0xef, 0xef, 0xcf, 0xef, 0xcf, 0xcf, 0xee, 0xc0, 0xe0, 0xc0, 0xe0, 0xc1, 0xe7, 0xce, 0xec, 0xcc, 0xe8, 0xed, 0xcf, 0xce, 0xe0, 0xe0, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 0xc0, 0xc0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
			DCB	  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x07, 0x07, 0x1f, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xff, 0xfb, 0xc7, 0x87, 0x07, 0x07, 0x07, 0x1f, 0x7f, 0xe0, 0x80, 0x00, 0x07, 0x3f, 0x7b, 0xe7, 0x87, 0x07, 0x07, 0xc3, 0xe7, 0xe7, 0xe7, 0xb3, 0xf7, 0xf7, 0xf7, 0xe7, 0xe3, 0xc7, 0x07, 0x07, 0xc7, 0xc7, 0xe7, 0x63, 0x37, 0x33, 0x37, 0xa7, 0xe7, 0x67, 0xc7, 0x43, 0x07, 0x0f, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 
			DCB	  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x0f, 0x1f, 0x3f, 0x3f, 0x7b, 0x7f, 0xff, 0xfe, 0xfe, 0xdc, 0xfc, 0x7d, 0xff, 0xfe, 0xdc, 0xf8, 0xf0, 0xe0, 0xe1, 0xc3, 0x86, 0x87, 0x8f, 0x8f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x09, 0x8c, 0x84, 0x86, 0x86, 0xc3, 0x63, 0x60, 0x30, 0x18, 0x0c, 0x0e, 0x07, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 
			DCB	  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00


winmsg		DCB		"You Win",0x04
			SPACE	0		; added for padding
		
			EXTERN	Nokia_Init			
			EXTERN	OutImgNokia
			EXTERN	SetXYNokia
			EXTERN	Out1BNokia
			EXTERN	OutStrNokia
			EXTERN	ClearNokia
			EXTERN  Sampl
			EXTERN  ADC_Init
			EXTERN	OutCrsUNokia
			EXTERN	OutCrsLNokia	
			EXTERN	Cleargamefield
			EXTERN  timer_init	
			EXTERN  My_GPIOPortF_Handler
			EXTERN	GPIO_Init
			EXTERN	OutBUNokia
			EXTERN	OutBLNokia
			EXTERN  OutCUNokia
			EXTERN  OutCLNokia
				
			EXPORT  Start
				

Start		BL		Nokia_Init			; initialize LCD
			LDR		R5, =imglogo
			BL		OutImgNokia
			LDR		R0,=0x001FFFFF
dela		SUBS	R0,#1
			BNE		dela
			LDR		R5, =imgFrame
			BL		OutImgNokia
			BL		GPIO_Init
			BL		timer_init	     	;start timer
			CPSIE	I				
	
			MOV 	R9,	 #0
			MOV		R10, #0
			BL		ADC_Init			
sample		BL		Sampl
			MOV		R0, #55		;Map the ADC value to the (6-70) for x axis  
			MUL		R4, R0
			MOV		R0,	#4095
			UDIV	R4, R0
			ADD		R4, #7
			MOV		R0, #24		;Map the ADC value to the (8-40) for y axis
			MUL		R5, R0
			MOV		R0, #4095
			UDIV	R5, R0			;R5 has Ypos(0-32)
			MOV 	R2, R5			;R2 will be used for remainder
			MOV		R0, #8
			UDIV	R5, R0
			MUL		R1, R5, R0
			SUB		R2, R1			;R2 contains remainder
			ADD		R5, #1			;R5 has Ypos(1-5)
			
;clear screen using 	ClearNokia routine
			BL		Cleargamefield
			MOV		R0, R4				; X pos 
			MOV		R1, R5				; Y pos 
			BL		SetXYNokia			; set XY position
			BL		OutCrsUNokia
			CMP		R2, #4
			BLT		skipL
			MOV		R0, R4				; X pos 
			ADD		R1, R5, #1			; Y pos (lower part of cursor)
			BL		SetXYNokia			; set XY position
			BL		OutCrsLNokia
skipL		MOV		R7, R9
			MOV		R8, R10
			LDR		R3,=XPOSC			; X pos 
			LDR		R4,=YPOSC			; Y pos 
			LDR		R5,=YPOSBITC		
loop1		CMP		R7, #0
			BEQ		checkb
			LDR		R0,[R3], #1			
			LDR		R1, [R4], #1
			BL		SetXYNokia			; set XY position
			LDR		R2,[R5], #1
			BL		OutCUNokia
			CMP		R2, #2
			BLT		skipCL
			ADD		R1, R1, #1			; Y pos (lower part of cursor)
			BL		SetXYNokia			; set XY position
			BL		OutCLNokia
skipCL		SUB 	R7, #1
			B		loop1
checkb		
			LDR		R3,=XPOSB			; X pos 
			LDR		R4,=YPOSB			; Y pos 
			LDR		R5,=YPOSBITB
loop2		CMP		R8, #0
			BEQ		return
			LDR		R0,[R3], #1			
			LDR		R1, [R4], #1
			BL		SetXYNokia			; set XY position
			LDR		R2,[R5], #1
			BL		OutBUNokia
			ADD		R1, R1, #1			; Y pos (lower part of cursor)
			BL		SetXYNokia			; set XY position
			CMP		R2, #2
			BLT		skipBL
			BL		OutBLNokia
skipBL		SUB 	R8, #1
			B		loop2
			
return		BL		delay
			B		sample

delay		PUSH	{R0}
			MOV		R0,#0xA000
del			SUBS	R0,#1
			BNE		del
			POP		{R0}
			BX		LR
		
			ALIGN
			END
